version: 2
jobs:
  build:
    machine:
      enabled: true
    steps:
      - run:
          name: Install dependencies
          command: pip install awscli --upgrade --user
      - run:
          name: Package and sync configs
          command: |
              mkdir /home/circleci/dashbase-quickstart
              cp -R . /home/circleci/dashbase-quickstart/ 
              tar -zcvf /home/circleci/quickstart.tar.gz --excl/ude="*.git*" --exclude="*.circle*" /home/circleci/dashbase-quickstart
              aws s3 sync /home/circleci/quickstart.tar.gz s3://dashbase-public/quickstart/
      - run:
          name: Update template_names.json file
          command: |
              echo '{"names":["quickstart"]} > template_names.json
              aws s3 sync template_names.json s3://dashbase-public/