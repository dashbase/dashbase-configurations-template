version: 2
jobs:
   build:
     docker:
       - image: circleci/python:2.7.13
     steps:
       - checkout
       - run:
          name: Install dependencies
          command: |
            python -m venv venv
            . venv/bin/activate
            pip install awscli --upgrade --user
       - run:
          name: Copy and package configs
          command: |
            mkdir ~/dashbase-quickstart
            cp -R . ~/dashbase-quickstart/
            tar -zcvf ~/dashbase-quickstart.tar.gz --exclude="*.git*" --exclude="*.circle*" ~/dashbase-quickstart
       - run:
          name: Sync to AWS S3 bucket
          command: |
            . venv/bin/activate
            aws s3 sync ~/dashbase-quickstart.tar.gz s3://dashbase-public/quickstart/
       - run:
          name: Update template_names.json file
          command: |
            . venv/bin/activate
            echo '{"names":["quickstart"]} > template_names.json
            aws s3 sync template_names.json s3://dashbase-public/